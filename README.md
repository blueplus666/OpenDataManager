# OpenDataManager - 开源多文档单元格批量同步工具

## 🚀 项目简介

**OpenDataManager** 是一款专为处理多重复文档设计的开源智能同步工具，核心功能是**通过节点工作流实现批量文件中自定义单元格的精确同步和修改**。不同于传统的固定位置同步，我们的工具支持每个文件中不同位置的单元格进行智能批量更新。

## ✨ 核心亮点

### 🔄 智能单元格定位同步

- **自定义位置同步**: 每个文件可以同步不同位置的单元格
- **智能定位**: 基于内容模式、行列标识或条件匹配定位目标单元格
- **批量异构处理**: 同时处理结构不同的多个文档
- **精确控制**: 只为每个文件同步需要更新的特定单元格

### ⚙️ 可视化节点工作流

- **灵活配置**: 为每个文件单独配置同步规则
- **条件路由**: 基于文件内容决定同步路径
- **批量映射**: 一次性定义多个文件的同步关系
- **实时预览**: 同步前预览所有变更内容

## 🛠️ 核心功能

### 异构文档同步工作流

```py
# 多文件自定义单元格同步配置
{
    "workflow_id": "multi_file_sync_001",
    "name": "多分支销售数据同步",
    "description": "将主表数据同步到不同结构的各分店报表",
    "nodes": [
        {
            "type": "file_input",
            "config": {
                "source_file": "./master/sales_data.xlsx",
                "sheets": ["汇总"]
            }
        },
        {
            "type": "cell_mapping",
            "config": {
                "target_files": [
                    {
                        "file": "./branches/store_a.xlsx",
                        "sheet": "月度数据",
                        "cell_mappings": [
                            {"source": "B2", "target": "C5"},    # 总销售额 → 门店销售额
                            {"source": "D10", "target": "F15"}   # 增长率 → 业绩增幅
                        ]
                    },
                    {
                        "file": "./branches/store_b.xlsx", 
                        "sheet": "业绩报表",
                        "cell_mappings": [
                            {"source": "B2", "target": "G8"},    # 总销售额 → 本月营收
                            {"source": "E5", "target": "H12"}    # 客单价 → 平均消费
                        ]
                    }
                ]
            }
        }
    ]
}
```

### 智能单元格定位

```py
# 基于条件的单元格定位
{
    "cell_location_strategy": "conditional",
    "rules": [
        {
            "condition": "cell_value_contains",
            "params": {"value": "销售额"},
            "target_cell": "offset(0, 1)"  # 定位到"销售额"右侧的单元格
        },
        {
            "condition": "header_match", 
            "params": {"header": "增长率"},
            "target_cell": "find_by_header"
        }
    ]
}
```

## 🎯 使用场景

### 场景1: 多结构报表数据同步

```py
源文件: 总部数据表.xlsx
├── 单元格 B5: 总销售额
├── 单元格 C8: 同比增长率
└── 单元格 D12: 区域占比

目标文件同步:
├── 分店A报表.xlsx (不同结构)
│   ├── 单元格 F10 ← 总销售额
│   └── 单元格 G15 ← 同比增长率
├── 分店B报表.xlsx (另一种结构)  
│   ├── 单元格 H5 ← 总销售额
│   └── 单元格 I8 ← 区域占比
└── 分店C报表.xlsx
    ├── 单元格 C20 ← 总销售额
    └── 单元格 D25 ← 同比增长率
```

### 场景2: 条件化单元格更新

```py
{
    "conditional_updates": [
        {
            "target_file": "./reports/store_*.xlsx",
            "update_rules": [
                {
                    "condition": "if_cell_value('B10') > 100000",
                    "updates": [
                        {"target": "C15", "value": "from_source('E5')"},
                        {"target": "D20", "value": "'高绩效'"}
                    ]
                },
                {
                    "condition": "else",
                    "updates": [
                        {"target": "C15", "value": "from_source('E6')"},
                        {"target": "D20", "value": "'标准'"}
                    ]
                }
            ]
        }
    ]
}
```

## 🏗️ 技术架构

### 核心同步引擎

```py
📦 单元格同步引擎
├── 🔍 单元格定位器
│   ├── 坐标直接定位
│   ├── 表头匹配定位  
│   ├── 条件搜索定位
│   └── 模式识别定位
├── 🔄 数据映射器
│   ├── 直接值复制
│   ├── 公式计算同步
│   ├── 条件转换同步
│   └── 多源数据合并
├── ⚙️ 批量处理器
│   ├── 并行文件处理
│   ├── 增量更新检测
│   ├── 冲突解决策略
│   └── 回滚管理机制
└── 📊 变更追踪器
    ├── 同步前后对比
    ├── 变更记录保存
    ├── 操作审计日志
    └── 异常报告生成
```

### 节点工作流系统

```py
🎯 同步工作流节点类型
├── 📁 文件输入节点
│   ├── 单文件选择
│   ├── 多文件批量
│   └── 文件夹扫描
├── 🎯 单元格映射节点
│   ├── 直接坐标映射
│   ├── 智能匹配映射
│   └── 条件路由映射
├── 🔧 数据处理节点  
│   ├── 格式转换
│   ├── 公式计算
│   ├── 数据验证
│   └── 条件过滤
├── 📤 文件输出节点
│   ├── 原地更新
│   ├── 副本保存
│   └── 模板生成
└── 🔀 控制节点
    ├── 条件分支
    ├── 循环处理
    └── 错误处理
```

## 💡 特色功能

### 1. 智能单元格匹配

```py
# 基于模式的自动单元格发现
{
    "auto_cell_detection": {
        "method": "pattern_matching",
        "patterns": [
            {
                "name": "销售额定位",
                "search_pattern": ".*销售额.*|.*销售合计.*",
                "target_offset": [0, 1]  # 右侧单元格
            },
            {
                "name": "日期定位", 
                "search_pattern": ".*日期.*|.*报告期.*",
                "target_offset": [1, 0]  # 下方单元格
            }
        ]
    }
}
```

### 2. 批量异构文件处理

```py
处理示例: 同时更新10个不同结构的报表
├── 报表A.xlsx: 更新 B5, C8, D10 单元格
├── 报表B.xlsx: 更新 F2, G5, H8 单元格  
├── 报表C.xlsx: 更新 A10, B15 单元格
├── 报表D.xlsx: 更新 C3, D6, E9, F12 单元格
└── ... (每个文件同步不同的单元格位置)
```

### 3. 可视化同步工作流界面

```py
┌─────────────────────────────────────────────────────────────────┐
│  🔄 OpenDataManager - 多文件单元格同步工作流        − □ ×         │
├─────────────────────────────────────────────────────────────────┤
│ [新建工作流] [保存] [运行] | [节点库] [模板] [设置]                 │
├──────────────┬─────────────────────────────┬────────────────────┤
│              │                             │                    │
│  📂 节点面板 │        🎯 工作流画布         │    📋 属性配置     │
│  ├ 文件输入   │   ┌─────┐    ┌─────┐        │  当前节点: 单元格映射│
│  ├ 单元格映射 │   │ 输入 │ -> │映射 │ -> ... │  ├ 目标文件数: 8个  │
│  ├ 数据转换   │   └─────┘    └─────┘        │  ├ 总单元格: 24个   │
│  └ 文件输出   │                             │  ├ 冲突数: 2个     │
│              │        📊 同步预览          │  └ 需要确认: 是     │
│  🎯 快速模板  │   ┌────────────────────┐   │                    │
│  ├ 财务报告   │   │ 文件A: B5 → 已就绪   │   │    ⚠️ 冲突详情     │
│  ├ 销售数据   │   │ 文件B: F2 → 待确认   │   │  ├ 文件C: 单元格被锁│
│  └ 库存报表   │   │ 文件C: A10 → 有冲突  │   │  └ 文件E: 数据不一致│
│              │   └─────────────────────┘   │                   │
└──────────────┴─────────────────────────────┴───────────────────┘
```

## 🚀 快速开始

### 基础使用示例

**场景**: 将主数据同步到8个不同结构的区域报表

1. **创建工作流**

   ```py
   # 定义多文件单元格同步
   workflow = {
       "name": "区域数据同步",
       "source": "master_data.xlsx",
       "targets": [
           {
               "file": "region_north.xlsx",
               "sync_cells": {"B2": "D5", "C5": "F8", "E10": "H12"}
           },
           {
               "file": "region_south.xlsx", 
               "sync_cells": {"B2": "G3", "C5": "I6", "E10": "K15"}
           },
           # ... 更多文件配置
       ]
   }
   ```

   

2. **执行同步**

   - 预览所有变更内容
   - 确认冲突解决方案
   - 批量执行同步操作
   - 生成同步报告

## 🔧 技术特性

- **精确单元格控制**: 每个文件独立配置同步位置
- **批量异构处理**: 同时处理结构完全不同的文档
- **智能冲突检测**: 自动识别并提示同步冲突
- **完整审计追踪**: 记录每次同步的详细操作日志
- **灵活扩展架构**: 支持自定义单元格定位策略

------

**OpenDataManager** - 让多文档单元格同步变得简单精确，无论您的文档结构如何差异，都能实现智能批量同步！